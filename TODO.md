–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (Device)


### –ì–ª–∞–≤–∞ 1: –ú–∞–∫–µ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (UI & Widgets)

–ù–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ –º—ã –Ω–µ –∑–∞–≤–∏—Å–∏–º –æ—Ç Riverpod, API –∏–ª–∏ —Å–µ—Ç–∏. –í—Å–µ –≤–∏–¥–∂–µ—Ç—ã —Å—Ç—Ä–æ—è—Ç—Å—è –∫–∞–∫ `StatelessWidget` (–∏–ª–∏ `Stateful` –¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –∞–Ω–∏–º–∞—Ü–∏–π) –∏ –ø—Ä–∏–Ω–∏–º–∞—é—Ç –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ —Å—Ç—Ä–æ–≥–æ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–ø—Ä–æ–ø—Å—ã) –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞—Ö. –î–∞–Ω–Ω—ã–µ –ø—Ä–æ–∫–∏–¥—ã–≤–∞—é—Ç—Å—è –∏–∑ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–Ω—ã—Ö –º–æ–∫–æ–≤.

**1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –º–æ–∫–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö (`mock_device_data.dart`)**

* –°–æ–∑–¥–∞—Ç—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∫–ª–∞—Å—Å–∞ `Device` –∏ `Sensor` (–∏—Å–ø–æ–ª—å–∑—É—è –Ω–∞—à–∏ `freezed` –º–æ–¥–µ–ª–∏).
* –ó–∞–¥–∞—Ç—å —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: IP (192.168.1.10), –ø–æ—Ä—Ç—ã, –ø–∞—Ä–æ—á–∫—É —Å–µ–Ω—Å–æ—Ä–æ–≤ —Å –Ω–æ—Ä–º–∞–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –∏ –æ–¥–∏–Ω —Å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º (–≤—ã—Ö–æ–¥—è—â–∏–º –∑–∞ `maxCritical`).

**2. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –≤–∏–¥–∂–µ—Ç—ã:**

* **`ThresholdBar` (–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —É—Å—Ç–∞–≤–æ–∫):**
  * *–ü—Ä–æ–ø—Å—ã:* `double min`, `double max`, `double currentValue`, `double? minCritical`, `double? maxCritical`, `Color primaryColor`.
  * *–û—Ç—Ä–∏—Å–æ–≤–∫–∞:* `CustomPaint` –∏–ª–∏ `LayoutBuilder` + `Container`. –†–∏—Å—É–µ—Ç —Å–µ—Ä—É—é –ø–æ–ª–æ—Å—É, –ø–æ–≤–µ—Ä—Ö –∫–æ—Ç–æ—Ä–æ–π —Ü–≤–µ—Ç–Ω—ã–º–∏ –æ—Ç—Ä–µ–∑–∫–∞–º–∏ (–∑–µ–ª–µ–Ω—ã–π/–∫—Ä–∞—Å–Ω—ã–π) –≤—ã–¥–µ–ª–µ–Ω—ã –∑–æ–Ω—ã. –¢—Ä–µ—É–≥–æ–ª—å–Ω—ã–π –º–∞—Ä–∫–µ—Ä —É–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.
* **`ExpandedSensorCard` (–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –¥–∞—Ç—á–∏–∫–∞):**
  * *–ü—Ä–æ–ø—Å—ã:* `Sensor sensor` (–ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–∞–º—É –º–æ–¥–µ–ª—å –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –û–û–ü, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∞ –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É–µ—Ç –≤—Å—ë –Ω—É–∂–Ω–æ–µ).
  * *–û—Ç—Ä–∏—Å–æ–≤–∫–∞:* * –í–µ—Ä—Ö–Ω–∏–π —Ä—è–¥: –ò–∫–æ–Ω–∫–∞ (–∏–∑ `uiConfig`), –ù–∞–∑–≤–∞–Ω–∏–µ –¥–∞—Ç—á–∏–∫–∞, –¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ + –µ–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è (–∫—Ä—É–ø–Ω–æ).
    * –°—Ä–µ–¥–Ω–∏–π —Ä—è–¥: `ThresholdBar` (–ø—Ä–æ–∫–∏–¥—ã–≤–∞–µ–º –ª–∏–º–∏—Ç—ã –∏–∑ `uiConfig`).
    * –ù–∏–∂–Ω–∏–π —Ä—è–¥: –ü–æ–ª–µ `slug` –∏–ª–∏ `data_type` —Å–µ—Ä—ã–º –º–µ–ª–∫–∏–º —Ç–µ–∫—Å—Ç–æ–º –¥–ª—è –∏–Ω–∂–µ–Ω–µ—Ä–∞.
  * *–ü–æ–≤–µ–¥–µ–Ω–∏–µ:* –ù–∞–∂–∞—Ç–∏–µ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É (–ø–æ–∫–∞ –ø—É—Å—Ç–æ–µ `onTap`).
* **`DeviceSummaryPanel` (–°–≤–æ–¥–∫–∞ –ø–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤—É):**
  * *–ü—Ä–æ–ø—Å—ã:* `int totalCount`, `int okCount`, `int alertCount`.
  * *–û—Ç—Ä–∏—Å–æ–≤–∫–∞:* `Row` —Å —Ç—Ä–µ–º—è –Ω–µ–±–æ–ª—å—à–∏–º–∏ –ø–ª–∞—à–∫–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ –±–∞–∑–µ `IiotCard`). –ö–∞–∂–¥–∞—è –ø–ª–∞—à–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–∫–æ–Ω–∫—É, –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Ü–∏—Ñ—Ä—É.
* **`DeviceHeaderInfo` (–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞):**
  * *–ü—Ä–æ–ø—Å—ã:* `String ipAddress`, `int port`, `int slaveId`.
  * *–û—Ç—Ä–∏—Å–æ–≤–∫–∞:* –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ `Chip` –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ–π —Ç–µ–∫—Å—Ç —Å –∏–∫–æ–Ω–∫–∞–º–∏ (üåê 192.168.0.1 | üîå Port: 502).
* **`DeviceDetailScreen` (–°–∞–º —ç–∫—Ä–∞–Ω - –°–±–æ—Ä–∫–∞):**
  * *–û—Ç—Ä–∏—Å–æ–≤–∫–∞:* `Scaffold`.
  * –í `AppBar` ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏ –±–µ–π–¥–∂–∏–∫ —Å—Ç–∞—Ç—É—Å–∞ (Online).
  * –í `body` ‚Äî `CustomScrollView` (–∏–ª–∏ `ListView`), –∫—É–¥–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –≤—Å—Ç—Ä–æ–µ–Ω—ã: `DeviceHeaderInfo`, –æ—Ç—Å—Ç—É–ø, `DeviceSummaryPanel`, –æ—Ç—Å—Ç—É–ø, —Å–ø–∏—Å–æ–∫ `ExpandedSensorCard`.
  * *–î–∞–Ω–Ω—ã–µ:* –í `build` –º–µ—Ç–æ–¥–µ –∂–µ—Å—Ç–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–±—ä–µ–∫—Ç –∏–∑ `mock_device_data.dart`.

---

### –ì–ª–∞–≤–∞ 2: –õ–æ–≥–∏–∫–∞ (State & Domain Layer)

–≠–∫—Ä–∞–Ω —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∂–∏–≤—ã–µ –¥–∞–Ω–Ω—ã–µ. –£ –Ω–∞—Å —É–∂–µ –µ—Å—Ç—å `DashboardController`, –∫–æ—Ç–æ—Ä—ã–π –¥–µ—Ä–∂–∏—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –∏—Ö –ø–æ SignalR. –ù–∞–º –Ω–µ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π WebSocket-—Å–ª—É—à–∞—Ç–µ–ª—å –¥–ª—è —ç—Ç–æ–≥–æ —ç–∫—Ä–∞–Ω–∞, –º—ã –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö.

**1. –î–æ—Ä–∞–±–æ—Ç–∫–∞ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –º–æ–¥–µ–ª–µ–π (Domain):**

* *–ü—Ä–æ–±–ª–µ–º–∞:* –ù–∞–º –Ω—É–∂–Ω–æ —Å—á–∏—Ç–∞—Ç—å —Å—Ç–∞—Ç—É—Å—ã (OK / Alert) –¥–ª—è `DeviceSummaryPanel`. –í—ã—Å—á–∏—Ç—ã–≤–∞—Ç—å —ç—Ç–æ –ø—Ä—è–º–æ –≤ UI ‚Äî –Ω–∞—Ä—É—à–µ–Ω–∏–µ SOLID.
* *–†–µ—à–µ–Ω–∏–µ:* –°–æ–∑–¥–∞—Ç—å `extension SensorStatusExt on Sensor` (–∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –≥–µ—Ç—Ç–µ—Ä –≤ –º–æ–¥–µ–ª—å, –µ—Å–ª–∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç freezed).
  * –ú–µ—Ç–æ–¥ `SensorStatus get status`: —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç `currentValue` —Å `uiConfigJson?.maxCritical` / `minCritical` –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `enum SensorStatus { normal, warning, critical, unknown }`.
* –°–æ–∑–¥–∞—Ç—å `extension DeviceSummaryExt on Device`:
  * –ì–µ—Ç—Ç–µ—Ä—ã: `int get normalSensorsCount`, `int get criticalSensorsCount`.

**2. –ü—Ä–æ–≤–∞–π–¥–µ—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è —ç–∫—Ä–∞–Ω–∞ (`device_detail_controller.dart`):**

* *–°—É—Ç—å:* –ù–∞–º –Ω—É–∂–µ–Ω –ø—Ä–æ–≤–∞–π–¥–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–¥–∞–µ—Ç –æ–¥–Ω–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–æ –µ–≥–æ ID, —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ —Ä–µ–∞–≥–∏—Ä—É—è –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –≥–ª–∞–≤–Ω–æ–º –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ.
* *–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:*

  ```dart
  @riverpod
  AsyncValue<Device> deviceDetail(Ref ref, int deviceId) {
  // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —Å–ø–∏—Å–æ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
  final dashboardState = ref.watch(dashboardControllerProvider);
  return dashboardState.when(
    data: (devices) {
      final device = devices.firstWhere(
        (d) => d.id == deviceId, 
        orElse: () => throw Exception('–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ')
      );
      return AsyncData(device);
    },
    loading: () => const AsyncLoading(),
    error: (err, stack) => AsyncError(err, stack),
  );
  ```

  }
* *–ó–∞—á–µ–º —Ç–∞–∫:* –ö–æ–≥–¥–∞ `SignalRService` –æ–±–Ω–æ–≤–∏—Ç –º–µ—Ç—Ä–∏–∫—É –≤ `DashboardController`, `deviceDetail` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –∏ –≤—ã–¥–∞—Å—Ç –Ω–æ–≤—ã–π —Å—Ç–µ–π—Ç `Device` —Å –Ω–æ–≤—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ `currentValue`.

---

### –ì–ª–∞–≤–∞ 3: –°—à–∏–≤–∞–Ω–∏–µ (Integration Layer)

–ù–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ –º—ã —É–¥–∞–ª—è–µ–º –º–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –ø–æ–¥–∫–ª—é—á–∞–µ–º UI –∏–∑ –ì–ª–∞–≤—ã 1 –∫ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º –∏–∑ –ì–ª–∞–≤—ã 2.

**1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Riverpod –∫ –≠–∫—Ä–∞–Ω—É:**

* –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º `DeviceDetailScreen` –≤ `ConsumerWidget`.
* –≠–∫—Ä–∞–Ω —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä: `final int deviceId;` –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ.
* –í–Ω—É—Ç—Ä–∏ –º–µ—Ç–æ–¥–∞ `build`:
  **Dart**

  ```
  final deviceState = ref.watch(deviceDetailProvider(deviceId));
  ```

**2. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π (AsyncValue):**

* –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º —Ç–µ–ª–æ `Scaffold` (–∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `CustomScrollView`) –≤ `deviceState.when(...)`:
  * `loading`: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º `CircularProgressIndicator` –∏–ª–∏ –∫—Ä–∞—Å–∏–≤—ã–π —Å–∫–µ–ª–µ—Ç–æ–Ω.
  * `error`: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∏–¥–∂–µ—Ç –æ—à–∏–±–∫–∏ —Å –∫–Ω–æ–ø–∫–æ–π "–ù–∞–∑–∞–¥".
  * `data`: —Ä–µ–Ω–¥–µ—Ä–∏–º –Ω–∞—à –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–π –º–∞–∫–µ—Ç.

**3. –ü—Ä–æ–∫–∏–¥—ã–≤–∞–Ω–∏–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–ø—Å–æ–≤:**

* –ò–∑ –ø–æ–ª—É—á–µ–Ω–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ `Device` –ø—Ä–æ–∫–∏–¥—ã–≤–∞–µ–º –ø–æ–ª—è –≤ —à–∞–ø–∫—É:
  `DeviceHeaderInfo(ipAddress: device.ipAddress, port: device.port, ...)`
* –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–µ extension-–º–µ—Ç–æ–¥—ã –¥–ª—è —Å–≤–æ–¥–∫–∏:
  `DeviceSummaryPanel(totalCount: device.sensors.length, okCount: device.normalSensorsCount, ...)`
* –†–µ–Ω–¥–µ—Ä–∏–º —Å–ø–∏—Å–æ–∫:
  **Dart**

  ```
  SliverList.builder(
    itemCount: device.sensors.length,
    itemBuilder: (context, index) {
      return ExpandedSensorCard(sensor: device.sensors[index]);
    },
  )
  ```

**4. –ò—Ç–æ–≥ —Å—à–∏–≤–∞–Ω–∏—è:**
–ö–∞–∫ —Ç–æ–ª—å–∫–æ –º—ã —Å–¥–µ–ª–∞–µ–º —ç—Ç–æ—Ç —à–∞–≥, –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —ç–∫—Ä–∞–Ω–∞ –º—ã —É–≤–∏–¥–∏–º —Ä–µ–∞–ª—å–Ω—É—é –∫–∞—Ä—Ç–∏–Ω—É —Å —Å–µ—Ä–≤–µ—Ä–∞. –ê –ø–æ—Å–∫–æ–ª—å–∫—É –º—ã –ø–æ–¥–ø–∏—Å–∞–ª–∏—Å—å –Ω–∞ —Ç–æ—Ç –∂–µ Riverpod-—Å—Ç–µ–π—Ç, —á—Ç–æ –∏ –î–∞—à–±–æ—Ä–¥, –∞–Ω–∏–º–∞—Ü–∏–∏ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö `ExpandedSensorCard` —Å—Ä–∞–±–æ—Ç–∞—é—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ —Ç—É –∂–µ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—É, –∫–∞–∫ —Å–µ—Ä–≤–µ—Ä –ø—Ä–∏—à–ª–µ—Ç –ø–∞–∫–µ—Ç –≤ –∫–∞–Ω–∞–ª `metrics_realtime`.
